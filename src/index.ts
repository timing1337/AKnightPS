import GameServer from './gameserver/gameserver';
import ClientPacket from './gameserver/packet/client_packet';
import ServerPacket from './gameserver/packet/server_packet';
import { HttpServer } from './http';
import { Config } from './utils/config';
Config.init();
HttpServer.start();
GameServer.start();

function testClient(msg: Buffer) {
    while (msg.length > 0) {
        const packetSize = msg.readUInt32BE();
        const packet = ClientPacket.decode(msg.subarray(0, 4 + packetSize));
        console.log(`SERVER < Receiving ${packet.cmdId} ${packet.data.length > 0 ? '| ' + packet.data.toString('hex') : ''}`);
        msg = msg.subarray(4 + packetSize, msg.length);
    }
}
function testServer(msg: Buffer) {
    while (msg.length > 0) {
        const packetSize = msg.readUInt32BE();
        const packet = ServerPacket.decode(msg.subarray(0, 4 + packetSize));
        console.log(`SERVER > sending ${packet.cmdId} ${packet.data.length > 0 ? '| ' + packet.data.toString('hex') : ''}`);
        msg = msg.subarray(4 + packetSize, msg.length);
    }
}


testClient(Buffer.from("0000003f0000002e00012f000f3230305f3230305f37333634323134002438306536303964632d346531382d343736342d623833362d36613831326233623462316400", 'hex'));
testServer(Buffer.from("0000001000010000ffff0000000000001827cb2a", 'hex'));

testClient(Buffer.from("00000571000000008a32300ae70a7b0d0a202022236465766963655f6964223a202239343762643337343231643930363937356466386132383362346366343964376330333362623030222c0d0a2020222363617272696572223a20224e554c4c222c0d0a202022236f73223a202257696e646f7773222c0d0a2020222373637265656e5f686569676874223a20313434302c0d0a2020222373637265656e5f7769647468223a20323536302c0d0a202022236d616e756661637475726572223a20224e5649444941222c0d0a202022236465766963655f6d6f64656c223a202253797374656d2050726f64756374204e616d6520284153555329222c0d0a2020222373797374656d5f6c616e6775616765223a20227669222c0d0a202022236f735f76657273696f6e223a202257696e646f777320313020202831302e302e313930343529203634626974222c0d0a202022236e6574776f726b5f74797065223a20224c414e222c0d0a2020222362756e646c655f6964223a2022222c0d0a202022236170705f76657273696f6e223a2022312e302e30222c0d0a202022237a6f6e655f6f6666736574223a20372e302c0d0a2020226f735f73686f72746e616d65223a202257696e646f7773222c0d0a2020226f735f74797065223a20322c0d0a20202267616d655f6964223a20223630303031222c0d0a20202267616d655f636f6465223a2022737367616d656f6d222c0d0a20202267616d655f6e616d65223a2022526576657273653a2031393939222c0d0a2020226170705f7061636b6167656e616d65223a2022636f6d2e626c7565706f63682e656e2e7265766572736531393939222c0d0a2020226170705f73646b5f76657273696f6e223a2022312e302e342e35222c0d0a2020226170705f7375626368616e6e656c6964223a202236303031222c0d0a2020226170705f6368616e6e656c6964223a2022323030222c0d0a2020226170705f6368616e6e656c5f76657273696f6e223a2022312e302e30222c0d0a202022696d7369223a20226665306435336566616238353433643262343930383162386461366163666465222c0d0a202022696d6569223a20226665306435336566616238353433643262343930383162386461366163666465222c0d0a20202275756964223a20226665306435336566616238353433643262343930383162386461366163666465222c0d0a2020226163636f756e745f6964223a20223230305f37333634323134222c0d0a20202269735f7061795f6163636f756e74223a2066616c73652c0d0a2020226163636f756e745f746167223a2022222c0d0a2020226163636f756e745f72656769737465725f74696d65223a2022323032332d31312d30332030313a30323a3530222c0d0a2020226163636f756e745f66697273746c6f67696e5f74696d65223a2022323032332d31312d30332030313a30323a3533222c0d0a2020222364697374696e63745f6964223a20226665306435336566616238353433643262343930383162386461366163666465222c0d0a202022236170705f6964223a20223165373866313361666564313466663261616663363864373939373633303666222c0d0a20202267636c6964223a2022222c0d0a2020226164466964223a2022222c0d0a2020226163636f756e745f74797065223a2031302c0d0a202022726567697374726174696f6e5f6163636f756e745f74797065223a2031302c0d0a20202262696e645f6c697374223a205b0d0a202020207b0d0a20202020202022757365724964223a20373336343231342c0d0a202020202020226163636f756e7454797065223a2031302c0d0a202020202020226163636f756e74223a20226361742a2a2a2a40676d61696c2e636f6d220d0a202020207d0d0a20205d0d0a7d", 'hex'));
testServer(Buffer.from("000000088a32000030000802", 'hex'));
testServer(Buffer.from("0000000691ef00003101", 'hex'));
testServer(Buffer.from("00000008d7f5000031021000", 'hex'));
testServer(Buffer.from("000001b039f7000032030a6a08aa969fc101120674696d696e671891b00a200e28c8063200420d08df17104118022000289dc612420d08bf17104618022000289dad12420d08d117103c1802200028a5bb124899f09c9eb9315002580a600e6807700378c2508001fadb97ccba318801e0cb9ec8ba311204080110011204080210001204080310011204080410011204080510011204080610011204080710011204080810011204080910011204080a10011204080b10011204080c10011204080d10011204080e10011204080f10011204081010011204081110011204081210011204081310011204081510011204081610011204081710011204081810011204081910011204081a10011204081b10011204081c10011204081d10011204081e10011204081f10011204082010011204082110011204082210011204082310011204082410011204082510011204082610011204082710011204082810001204082910011204082a10011204082b10011204082c10011204082d10011204082e10011204082f1001120408301001120408311001120408321001120408331000120408371001120408631001180120012800", 'hex'));
testServer(Buffer.from("000000b851c3000033040a0b0801100018a7f09c9eb9310a0c080210a60e18a7f09c9eb9310a0d08031093eb0218a7f09c9eb9310a0c080410ae0118a793a5ccba310a0c080510f65718a7f09c9eb9310a0b0806100018a7f09c9eb9310a0c080a10cf0118a7f09c9eb9310a0b080b100618a7f09c9eb9310a0b080c100018a7f09c9eb9310a0c081410bd0118a7f09c9eb9310a0b0815107618a7f09c9eb9310a0c081610e20118a7f09c9eb9310a0c081710cc0818a7f09c9eb931", 'hex'))
testServer(Buffer.from("000002f50839000034050a0e08810110ffffffffffffffffff010a0e08820110ffffffffffffffffff010a0e08840110ffffffffffffffffff010a0e08850110ffffffffffffffffff010a0508870110000a0e08880110ffffffffffffffffff010a0e08890110ffffffffffffffffff010a0e088a0110ffffffffffffffffff010a0e088b0110ffffffffffffffffff010a0e088e0110ffffffffffffffffff010a0e088f0110ffffffffffffffffff010a0e08910310ffffffffffffffffff010a0e08910110ffffffffffffffffff010a0e08920310ffffffffffffffffff010a0e08920410ffffffffffffffffff010a0e08950310ffffffffffffffffff010a0e08960310ffffffffffffffffff010a0e08960110ffffffffffffffffff010a0e08970110ffffffffffffffffff010a0e08980310ffffffffffffffffff010a0e08990310ffffffffffffffffff010a0e089b0310ffffffffffffffffff010a0e089c0310ffffffffffffffffff010a0e089d0310ffffffffffffffffff010a0e08a00110ffffffffffffffffff010a0e08ad0210ffffffffffffffffff010a0e08ae0210ffffffffffffffffff010a0e08af0210ffffffffffffffffff010a0e08b00210ffffffffffffffffff010a0e08b10210ffffffffffffffffff010a0508b30210000a0e08b50210ffffffffffffffffff010a0e08b70110ffffffffffffffffff010a0d086510ffffffffffffffffff010a0d086610ffffffffffffffffff010a0d086710ffffffffffffffffff010a0d086810ffffffffffffffffff010a0d086a10ffffffffffffffffff010a0d086c10ffffffffffffffffff010a0d086d10ffffffffffffffffff010a0d086e10ffffffffffffffffff010a0d087010ffffffffffffffffff010a0d087410ffffffffffffffffff010a0e08f50310ffffffffffffffffff010a0e08f60310ffffffffffffffffff010a0d087710ffffffffffffffffff010a0d087a10ffffffffffffffffff010a04087c10000a0e08fe0310ffffffffffffffffff010a0508ff031000", 'hex'));
testServer(Buffer.from("000000069c6000003506", 'hex'));
testServer(Buffer.from("00000023cbad00003607080208030804080508060807100620d6a792aa0638c61738dc1738dd17", 'hex'));
testServer(Buffer.from("000001b039f7000032030a6a08aa969fc101120674696d696e671891b00a200e28c8063200420d08df17104118022000289dc612420d08bf17104618022000289dad12420d08d117103c1802200028a5bb124899f09c9eb9315002580a600e6807700378c2508001fadb97ccba318801e0cb9ec8ba311204080110011204080210001204080310011204080410011204080510011204080610011204080710011204080810011204080910011204080a10011204080b10011204080c10011204080d10011204080e10011204080f10011204081010011204081110011204081210011204081310011204081510011204081610011204081710011204081810011204081910011204081a10011204081b10011204081c10011204081d10011204081e10011204081f10011204082010011204082110011204082210011204082310011204082410011204082510011204082610011204082710011204082810001204082910011204082a10011204082b10011204082c10011204082d10011204082e10011204082f1001120408301001120408311001120408321001120408331000120408371001120408631001180120012800", 'hex'));
testServer(Buffer.from("000002f899ea000037080a05089a0310000a8c01086f10001a0608e1e40610011a0608e3e40610001a0608e5e40610001a0608c5e50610001a0608c6e50610001a0608f1e70610001a0608d5e80610001a0608d7e80610001a0608d6e80610011a0608d9e80610001a0608d8e80610001a0608fbe70610001a0608fae70610001a0608fde30610021a0608fde70610001a0608fce70610001a0608fee70610000a3108e20410001a0708aca8f40210001a0608da9d2510001a0708aba8f40210011a0708a1a8f40210011a0708a3a8f40210000a9d0108960110001a0608a3940910001a060885940910001a06088f940910001a0608ad940910001a0608f1930910001a0608d6940910001a0608b7940910001a0608d7940910001a0608d5940910001a0608da940910001a0608ba950910001a0608db940910001a0608fb930910001a0608d8940910001a060899940910001a0608d9940910001a06089e960910001a0608dc940910001a06089d960910000a4d08aa0110001a0608f6b00a10001a0608f7b00a10001a0608f4b00a10001a0608f5b00a10001a0608fab00a10001a0608fbb00a10001a0608f8b00a10001a0608f9b00a10001a0608fcb00a10000ac201087210001a060880fd0610001a0d08a3fc0610001898b1f085bb311a060887fd0610001a060886fd0610001a0608ebfd0610001a06088d800710001a0608f1800710001a0608b5fb0610001a060897800710001a060896800710001a0d0899fc0610001898b1f085bb311a060899800710001a060898800710001a0608fb800710001a06089a800710001a0608fa800710001a0608fdfc0610001a0608fd800710001a0608fc800710001a0608fffc0610001a0608fefc0610001a0608fe800710000a6508a00110001a0608b0e40910001a0608b1e40910001a0608e6e20910001a0608e7e20910001a0608e5e20910011a0608cae30910001a0608cbe30910001a0608c9e30910001a0608aee40910001a0608afe40910001a0608cce30910001a0608ade40910000a0c087610001a0608f299071027", 'hex'))
testServer(Buffer.from("00000cf4f2c3000038090a0e0882e209100018002000281030000a1108914e100018002000280130a0b8adaa060a1108924e100018002000280130a0b8adaa060a1108934e100018002000280130a0b8adaa060a1108944e100018002000280130a0b8adaa060a11089b4e100018002000280130a0b8adaa060a11089c4e100018002000280130a0b8adaa060a11089d4e100018002000280130a0b8adaa060a1108a54e100018002000280130a0b8adaa060a1108a64e100018002000280130a0b8adaa060a1108af4e100018002000280130a0b8adaa060a1108b04e100018002000280130a0b8adaa060a1108b14e100018002000280130a0b8adaa060a1108b94e100118002001280130a0b8adaa060a1108ba4e100018002000280130a0b8adaa060a1108bb4e100118002001280130a0b8adaa060a1108c34e100018002000280130a0b8adaa060a1108c44e100018002000280130a0b8adaa060a1108cd4e100218002001280130a0b8adaa060a1108d74e100018002000280130a0b8adaa060a1108d84e100018002000280130a0b8adaa060a0e08c1b802100118002001280430000a0e08c2b802100118002001280430000a0e08c3b802100118002001280430000a0e08c4b802100118002001280430000a0e08c5b802100318002001280430000a0e08c6b802101718002001280430000a0e08c7b802101718002001280430000a0e08c8b802101718002001280430000a0e08c9b802101718002001280430000a0e08cab802100118002001280430000a0e08cbb802100618002001280430000a0e08ccb802100118002001280430000a0e08cdb802100218002001280430000a0e08ceb802100118002001280430000a0e08cfb802100218002001280430000a0e08d0b802100218002001280430000a0e08d1b802100218002001280430000a0e08d2b802100218002001280430000a0e08d3b802100118002001280430000a0e08d4b802100218002001280430000a0e08d5b802100118002001280430000a0e08d6b802100118002001280430000a0e08d7b802100418002001280430000a0e08d8b802100518002001280430000a0e08d9b802100118002001280430000a0e08dab802100618002001280430000a0e08dbb802100118002001280430000a0e08dcb802100118002001280430000a0e08ddb802100218002001280430000a0e08deb802100218002001280430000a0e08dfb802100618002001280430000a0e08e0b802100118002001280430000a0e08e1b802100118002001280430000a0e08e2b802100018002000280430000a0e08e3b802100218002001280430000a0e08e4b802100218002000280430000a0e08e5b802100118002001280430000a0e08e6b802101e18002001280430000a0e08e7b802100018002000280430000a0e08a4b902100118002001280430000a0e08a5b902100118002001280430000a0e08a6b902100118002001280430000a0e08a7b902100118002001280430000a0e08a8b902100118002001280430000a0e08a9b902100118002001280430000a0e08aab902100118002001280430000a0e08abb902100118002001280430000a0e08acb902100118002001280430000a0e08adb902100118002001280430000a0e08aeb902100118002001280430000a0e08afb902100118002001280430000a0e08b0b902100118002001280430000a0e08b1b902100118002001280430000a0e08b2b902100118002001280430000a0e08b3b902100118002001280430000a0e08b4b902100118002001280430000a0e08b5b902100018002000280430000a1208a19c01100918002000280230a0e7c7aa060a1208a29c01100918002000280230a0e7c7aa060a1208a39c01100918002000280230a0e7c7aa060a1208a49c01100918002000280230a0e7c7aa060a1208a59c01100918002000280230a0e7c7aa060a1208ab9c01", 'hex'));

